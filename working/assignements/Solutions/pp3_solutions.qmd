---
title: "Practice Problems 3 - SOLUTIONS"
format: 
  html:
    embed-resources: true
    toc: true
---

# Purpose

The goal of this set of practice problems is to practice the following skills:

- Building appropriate multiple linear regression models to address research questions
- Interpreting linear regression model results with a mix of quantitative and categorical predictors




# Directions

1. Create a code chunk in which you load the `ggplot2`, `dplyr`, and `readr` packages. Include the following command in the code chunk to read in the data: `lifts <- read_csv("https://mac-stat.github.io/data/powerlifting.csv")`

2. Continue with the exercises below. You will need to create new code chunks to construct visualizations and models and write interpretations beneath. Put text responses in blockquotes as shown below:

> Response here. (The > at the start of the line starts a blockquote and makes the text larger and easier to read.)

3. Render your work for submission:
    - Click the "Render" button in the menu bar for this pane (blue arrow pointing right). This will create an HTML file containing all of the directions, code, and responses from this activity. A preview of the HTML will appear in the browser.
    - Scroll through and inspect the document to check that your work translated to the HTML format correctly.
    - Close the browser tab.
    - Go to the "Background Jobs" pane in RStudio and click the Stop button to end the rendering process.
    - Locate the rendered HTML file in the folder where this file is saved. Open the HTML to ensure that your work looks as it should (code appears, output displays, interpretations appear). Upload this HTML file to Moodle.

```{r}
library(ggplot2)
library(dplyr)
library(readr)

lifts <- read_csv("https://mac-stat.github.io/data/powerlifting.csv")
```


# Exercises

## Context

Powerlifting is a sport in which athletes compete to lift as much as possible in 3 events: bench press, squat, and deadlift.

[Open Powerlifting](https://www.openpowerlifting.org/) maintains a database of competition results for powerlifters across the world. We have information on 100,000 lifters from this database. Take a look at the codebook [here](https://github.com/Mac-STAT/data/blob/main/powerlifting_codebook.md).

Research question: Are lighter or heavier lifters proportionately stronger?


## Exercise 1: Define outcome variable

Use the `mutate()` function from the `dplyr` to define an outcome variable called `SWR` that stands for strength-to-weight ratio. It should be computed as `TotalKg` divided by `BodyweightKg`. `SWR` measures how many times their bodyweight an athlete can lift in total. Higher numbers indicate higher relative strength.

```{r}
lifts <- lifts %>% 
    mutate(SWR = TotalKg/BodyweightKg)
```




## Exercise 2: Exploratory visualizations

**Guiding question:** How are age, sex, bodyweight, and equipment usage related to strength?

Construct one visualization for each of these 4 explanatory variables and `SWR`. For each, write 1-2 sentences summarizing what you learn from the plot. Be sure to discuss trend, variability/dispersion about the trend, and any notable outliers.

```{r}
ggplot(lifts, aes(x = Age, y = SWR)) +
    geom_point(alpha = 0.1) +
    geom_smooth(se = FALSE) +
    geom_smooth(method = "lm", color = "red", se = FALSE)
```

> There seems to be a generally negative relationship between SWR and age: older lifters tend to have lower relative strength. There is a bit of an upslope at the beginning, but this trend seems uncertain because of the relatively few cases with such low ages. (Note: we see better that there are fewer cases on the left by adjusting the transparency of the points with alpha = 0.1 in `geom_point`.) There is considerable spread around the trend, and there don't seem to be any particularly notable outliers.




```{r}
ggplot(lifts, aes(x = Sex, y = SWR)) +
    geom_boxplot()
```

> Males have the highest average SWRs with a median of about 5 and the highest spread of the 3 categories. Females follow with a median SWR of about 2.75 and lower spread. The Mx sex is a gender-neutral designation (see [here](https://openpowerlifting.gitlab.io/opl-csv/bulk-csv-docs.html)): these lifters have lower SWRs at about 2.5 with smaller spread.




```{r}
ggplot(lifts, aes(x = BodyweightKg, y = SWR)) +
    geom_point(alpha = 0.1) +
    geom_smooth(se = FALSE) +
    geom_smooth(method = "lm", color = "red", se = FALSE)
```

> Similar observations to the plot of SWR vs age.
>
> There seems to be a generally negative relationship between SWR and bodyweight: heavier lifters tend to have lower relative strength. There is a bit of an upslope at the beginning, but this trend seems uncertain because of the relatively few cases with such low bodyweights. There is considerable spread around the trend, and there don't seem to be any particularly notable outliers.




```{r}
ggplot(lifts, aes(x = Equipment, y = SWR)) +
    geom_boxplot()
```

> There is some variation in SWR across equipment types. Lifters who use wraps have the highes SWRs while those who use multi-ply suits and those in the unlimited category tend to have lower SWRs.






## Exercise 3: Causal diagram

We are interested in the relationship between `BodyweightKg` and `SWR` but are concerned about `Age`, `Sex`, and `Equipment` as potential confounders.

### Part a

Draw a causal diagram that shows how these 5 variables might be related. Draw this by hand or software and save the file as `pp3_dag.jpg` or `pp3_dag.png` in the same folder as this `.qmd` file. You can then insert the diagram as below:

![](pp3_dag.png)

> Responses will vary but age, sex, and equipment almost certainly have an impact on SWR as seen from Exercise 2, so direct arrows from these variables to SWR should be present. Also contextually, it makes sense that these would be direct causes of strength.
> 
> Also sex likely has a clear effect on bodyweight. For the age range under investigation, age might not have a strong relationship with bodyweight, but it's a possibility, so we include that arrow. (It's ok if students decide to not include this arrow.) We include an arrow from bodyweight to SWR to represent the causal effect of interest. Other arrows (presence or absence) may vary.


### Part b

Use visualizations to explore if `Age`, `Sex`, and `Equipment` have a relationship with `BodyweightKg`. Explain how these explorations relate to your causal diagram. Do you think that there are other confounders that would be important to consider but are missing from our data?

> **Grading notes:** It's ok if the students' responses don't look exactly like the example resoponse here. They should just relate any relationship or lack of relationship they see between bodyweight and age, sex, equipment to the presence/absence of arrows/lines on their causal diagram.

> **Example response:**
> 
> We previously explored the relationship between each of these variables and SWR. We hypothesized that each of these variables directly impacts SWR, and this was substantiated by our plots in Exercise 2.
> 
> Now we are investigating how these variables are associated with the predictor of interest: bodyweight. Without this association, these variables would not confound the relationship between bodyweight and SWR.
> 
> There is a slight relationship between age and bodyweight: this relationship looks generally slightly positive at younger ages with a slight decrease at older ages. Bodyweight clearly varies across the sexes and to a modest extent across equipment types.
>
> Conclusion: age, sex, and equipment are related to bodyweight in our data. This observation would be in line with a causal diagram in which there are connections from each of these variables to bodyweight (either with direct arrows or indirectly with just a line connecting them).
> 
> Another important confounder not present in our data is intensity of traning program. Higher intensities likely lead to higher strength, and it's possible that heavier lifters engage in higher intensity training.

```{r}
ggplot(lifts, aes(x = Age, y = BodyweightKg)) +
    geom_point(alpha = 0.1) +
    geom_smooth(se = FALSE) +
    geom_smooth(method = "lm", se = FALSE, color = "red")

ggplot(lifts, aes(x = Sex, y = BodyweightKg)) +
    geom_boxplot()

ggplot(lifts, aes(x = Equipment, y = BodyweightKg)) +
    geom_boxplot()
```




## Exercise 4: Linear regression modeling

Research question: Are lighter or heavier lifters proportionately stronger?

Put another way, this question is getting at the causal effect of bodyweight on SWR.

### Part a

Fit an appropriate linear regression model that answers our research question.

> The students should include in this model bodyweight as well as the variables they believe to be confounders based on their causal diagram.
> 
> Technically speaking the causal diagram above in these solutions tells us that we only need to adjust for age and sex, but students may have different diagrams. I'm showing a linear regression model that includes the predictor of interest and all 3 other variables as confounders.

```{r}
lifts_mod <- lm(SWR ~ BodyweightKg + Age + Sex + Equipment, data = lifts)
summary(lifts_mod)
```


### Part b

Interpret the coefficient that answers our research question. *Make sure to use appropriate causation vs. association language, include units, and talk about averages rather than individual cases.*

> The BodyweightKg coefficient is the one that answers our research question.
>
> Interpretation: Among lifters of the same age, sex, and equipment usage, every one kilogram increase in bodyweight is associated with a 0.007 unit decrease in SWR. In other words, a 10kg increase in bodyweight is associated with a 0.07 unit decrease in SWR.

> **Grading notes:** There are no units for SWR but students should include units for bodyweight.

### Part c

Interpret the remainder of the coefficients (including the intercept). Is it meaningful to interpret the intercept in this context?

> Intercept: The average SWR for lifters who weigh 0 kg, age 0, are female, and use multi-ply suits is 4.8. This doesn't make sense because no one is 0 kg and 0 years old!

> Age: On average, each additional year of age is associated with a 0.03 unit decrease in SWR, among lifters of the same bodyweight, sex, and equipment usage (holding bodyweight, sex, and equipment usage constant).

> SexM: On average, male lifters have a 1.01 higher SWR than female lifters, among lifters of the same bodyweight, age, and equipment usage.

> SexMx: On average, Mx lifters have a 0.05 lower SWR than female lifters, among lifters of the same bodyweight, age, and equipment usage.

> **Note: there are a lot of equipment coefficients! It's fine if they just interpret 2 of them.**

> EquipmentRaw: On average, lifters who lift raw have a 0.03 higher SWR than those who use multi-ply suits, among lifters of the same bodyweight, age, and sex.

> EquipmentSingle-ply: On average, lifters who lift with single-ply suits have a 0.64 higher SWR than those who use multi-ply suits, among lifters of the same bodyweight, age, and sex.

> EquipmentStraps: On average, lifters who lift with straps have a 0.71 lower SWR than those who use multi-ply suits, among lifters of the same bodyweight, age, and sex.

> EquipmentUnlimited: On average, lifters who lift in the unlimited equipment category have a 0.63 lower SWR than those who use multi-ply suits, among lifters of the same bodyweight, age, and sex.

> EquipmentWraps: On average, lifters who lift with wraps have a 1.57 higher SWR than those who use multi-ply suits, among lifters of the same bodyweight, age, and sex.

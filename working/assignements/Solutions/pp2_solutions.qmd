---
title: "Practice Problems 2 - SOLUTIONS"
format: 
  html:
    embed-resources: true
---


```{r setup}
#| include: false

# Do NOT modify this chunk
knitr::opts_chunk$set(
  collapse = TRUE, 
  warning = FALSE,
  message = FALSE,
  error = TRUE,
  fig.height = 2.75, 
  fig.width = 4.25,
  fig.env = 'figure',
  fig.pos = 'h',
  fig.align = 'center')
```

# Purpose

The goal of this set of practice problems is to practice the following skills:

- Model evaluation: Is the model "correct"? Is the model "strong"? Is the model "fair"?
- Transformations of variables: center, scale, and log
- Making and interpreting residual plots


# Directions

1. Create a code chunk in which you load the `ggplot2`, `dplyr`, and `readr` packages. Include the following command in the code chunk to read in the data: `enroll <- read_csv("https://mac-stat.github.io/data/school_enrollment.csv")`

2. Continue with the exercises below. You will need to create new code chunks to construct visualizations and models and write interpretations beneath. Put text responses in blockquotes as shown below:

> Response here. (The > at the start of the line starts a blockquote and makes the text larger and easier to read.)

3. Render your work for submission:
    - Click the "Render" button in the menu bar for this pane (blue arrow pointing right). This will create an HTML file containing all of the directions, code, and responses from this activity. A preview of the HTML will appear in the browser.
    - Scroll through and inspect the document to check that your work translated to the HTML format correctly.
    - Close the browser tab.
    - Go to the "Background Jobs" pane in RStudio and click the Stop button to end the rendering process.
    - Locate the rendered HTML file in the folder where this file is saved. Open the HTML to ensure that your work looks as it should (code appears, output displays, interpretations appear). Upload this HTML file to Moodle.


```{r}
library(ggplot2)
library(dplyr)
library(readr)
enroll <- read_csv("https://mac-stat.github.io/data/school_enrollment.csv")
```


# Exercises

## Context

In the following exercises, we'll work with data from the World Bank on secondary school enrollment. 

We have access to the following information:

- `Country`: country name
- `Year`: year enrollment was measured (ranges from 2004 - 2019)
- `GER`: gross enrollment rate in secondary school (%)
- `NER`: net enrollment rate in secondary school (%)

Net enrollment rate (NER) is the ratio of children who are *of secondary school age* who are enrolled in secondary school, out of the total number of children of secondary school age. In contrast, gross enrollment rate (GER) is the ratio of children who are enrolled in secondary school *regardless of age*, out of the total number of children of secondary school age. NER ranges from 0 to 100%, since it is a true proportion, while GER can exceed 100% (some children who are *not* of secondary school age may in fact be enrolled).

Historically, NER is more difficult to measure than GER (particularly in low- and middle-income countries), since it requires knowledge of the age of the children enrolled in school. 

A relevant research question is: If we know GER, can we accurately predict NER? In order to answer this question, we first want to better understand the relationship between GER and NER.



These practice problems are inspired by a [recent paper](https://arxiv.org/pdf/2401.01872) that aims to develop statistical methods for analyzing this problem. The methods described in this paper are beyond the scope of this course, but we link it here in case you are interested in learning more!


## Exercise 1: Visual and numerical summaries

### Part a

They should make a scatterplot with `NER` on the y-axis and `GER` on the x-axis, with both a curved and straight trend line using `geom_smooth`.


```{r}
enroll %>%
  ggplot(aes(x = GER, y = NER)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  geom_smooth(se = FALSE, col = "red")
```
Based on this visualization, do you think a linear regression model would correctly explain the relationship between NER and GER? Explain why or why not.

> They should note that the linear regression model seems sufficient for lower values of GER, but incorrect once GER starts to exceed about 100. In general, they should respond that a linear regression model is likely not correct and give a reason as to why (the smooth trend line and linear trend line vary).

### Part b

Calculate and report the correlation between GER and NER. Do you think correlation is an appropriate numerical summary for the relationship between GER and NER? Explain why or why not (you may make reference to your answer to Part a, if relevant).

```{r}
enroll %>% 
  summarize(cor(GER, NER))
```

> Although correlation is high, it is likely not an appropriate summary because the relationship does not appear linear, and correlation is a summary of a linear relationship.

## Exercise 2: Fitting a simple linear regression model

Suppose we decide to go ahead and fit a linear regression model, with GER as our predictor and NER as our outcome. Fill in the model statement below (using proper notation) that corresponds to this regression:

$$
E[NER | GER] = \beta_0 + \beta_1 GER
$$

> If they use any symbol other than $\beta$ here, please remind them to use $\beta$'s on future assignments!

Fit the linear regression model that you wrote above.

```{r}
mod <- lm(NER ~ GER, data = enroll)
mod
```

> This answer only needs to be code and model formula, no other text necessary.

## Exercise 3: Model Eval: "Correct" and "Fair"

### Part a

Make a plot of residuals vs. fitted values for the model you fit in Exercise 2. Does this diagnostic plot suggest that your model is *wrong*? Explain why or why not.

```{r}
ggplot(mod, aes(x = .fitted, y = .resid)) + 
    geom_point() + 
    geom_hline(yintercept = 0) +
    geom_smooth(se = FALSE)
```
> Their answer should note that the residual plot suggests the model is wrong, because there is a clear pattern to the residuals vs. fitted values, particularly for fitted values greater than 100 (the fitted line between residuals and fitted values is not even remotely a straight, horizontal line).

### Part b

Do you think this model is *fair*? Explain your reasoning. NOTE: There's not a single "best" answer here. Utilize critical thinking skills and context.

> Answers will vary. Give full credit if: (1) the responses reflect an understanding of what this question is asking; and (2) they provide reasonable explanation.

## Exercise 4: Model Eval: "Strong"

Report and interpret, in context, the multiple $R^2$ value from the linear regression model you fit in Exercise 2. Your answer should demonstrate your understanding of how to *interpret* this number (what it actually *means* or *measures*) and of whether it indicates that this particular model is strong, moderate, or weak.

```{r}
summary(mod)
```

> They need to report **and** interpret R^2 here, which is 0.8875. The interpretation of this value is: 88% of the variation in NER can be explained by the variation in GER. Since this value is close to 1 (100%), it suggests the model is strong.

## Exercise 5: Thinking about transformations

### Part a

Currently in the data, NER is reported on a scale from 0 - 100. How would the slope in your model change (if at all) from Exercise 2 if NER were transformed to be on a scale from 0-1? How would the intercept in your model change (if at all) from Exercise 2 if NER were transformed to be on a scale from 0-1? **If it helps you think it through, mutate NER and fit this model!**

```{r}
coef(mod)
coef(lm((NER / 100) ~ GER, data = enroll))
```

> They don't need to include code for this part, just reasonable/correct explanations.

> The intercept would be 100x smaller, because it is the expected NER when GER is zero. The slope would also be 100x smaller, because it is "rise"/"run", and we would have essentially made the "rise" 100x smaller.

### Part b

Suppose I want the intercept of my model of NER by GER to have the interpretation of the expected average NER for a GER of 80%. Suggest a transformation I could make to one or both of these variables that would give the intercept of my linear regression model this interpretation.

> They do not need to write a model statement for this or provide code, but should note that this could be achieved by creating a new variable by subtracting 80 from GER. 

$$
E[NER | GER] = \beta_0 + \beta_1 (GER - 80)
$$

